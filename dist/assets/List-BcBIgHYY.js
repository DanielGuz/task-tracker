import{d as z}from"./DataServiceApi-jMRJP3iC.js";import{d as I,f as V,a as P,_ as w,o,c as u,b as l,w as r,e as j,v as q,g as p,t as m,r as A,n as D,T as M,h as v,i as O,j as R,k as L,F,l as C,m as $,p as d,q as _,s as H,u as K,x as Y,y as J}from"./index-COHp593Y.js";import{T as E}from"./Button-VjdmMWdi.js";const G=[{field:"id_usuario",label:"Id"},{field:"nombre",label:"Nombre",sortable:!0},{field:"apellido",label:"Apellido",sortable:!0},{field:"numdoc",label:"Documento",sortable:!0},{field:"usuario",label:"Usuario",sortable:!0},{date:!0,field:"fecha_creacion",label:"Fecha creación",sortable:!0},{date:!0,field:"fecha_login",label:"Última sesión",sortable:!0}],U=I("dataTable",{state:()=>({columns:[],data:[],filters:{},pagination:{page:1,sortfield:"id",sortorder:"ASC"},params:{},recordsPerPage:10,selectedData:{},showFilters:!1,showLoader:!1,statusData:[{id:"2",name:"Activo"},{id:"1",name:"Inactivo"}],tabFilterLabels:{},totalRecords:0}),getters:{getFilters(e){const t={},a=Object.keys(e.filters);for(let i=0;i<a.length;i+=1)Array.isArray(e.filters[a[i]])&&e.filters[a[i]].length>0&&(t[a[i]]=e.filters[a[i]].join(",")),!Array.isArray(e.filters[a[i]])&&e.filters[a[i]]&&(t[a[i]]=e.filters[a[i]]);return t}},actions:{setData(e){this.data=e},setLoading(e){this.showLoader=e},setTotalRecords(e){this.totalRecords=e},setRecordsPerPage(e){this.recordsPerPage=e},setFilters(e){this.filters=e},setPaginationData(e){this.pagination=e},setShowFilters(e){this.showFilters=e},setColumnsTable(e){this.columns=e},setTabFiltersLabels(e){this.tabFilterLabels=e},fetchDataTable(e){const{url:t,filters:a,withParams:i}=e;this.setLoading(!0),i&&{...this.pagination,filtros:JSON.stringify({...this.getFilters,...a})};const h=[{id_usuario:1,nombre:"User",apellido:"1",usuario:"user",numdoc:123456,fecha_login:"01-01-2024",fecha_creacion:"01-01-2024"},{id_usuario:2,nombre:"User",apellido:"2",usuario:"user",numdoc:789014,fecha_login:"01-01-2024",fecha_creacion:"01-01-2024"}];this.setData(h),this.setTotalRecords(2),this.setRecordsPerPage(10),this.setLoading(!1)},updateColumnsTable(e){this.setColumnsTable(e)},updateFilters(e){this.setFilters(e)},updatePaginationData(e){this.setPaginationData(e)},toggleFilterDrawer(e){this.setShowFilters(e)},updateTabFiltersLabels(e){this.setTabFiltersLabels(e)}}}),Q={setup(){return{dataTable:U()}},data(){return{actionbuttons:[],descriptionRowProperty:"",fetchPayload:{url:"",withParams:!1},idRowProperty:"id",isFetching:!1,routeBaseName:""}},computed:{data(){return this.dataTable.data},filters(){return this.dataTable.filters},columns(){return this.dataTable.columns},showLoader(){return this.dataTable.showLoader},pagination(){return this.dataTable.pagination},showFilters(){return this.dataTable.showFilters},totalRecords(){return this.dataTable.totalRecords},recordsPerPage(){return this.dataTable.recordsPerPage},tabFilterLabels(){return this.dataTable.tabFilterLabels},filterTabKeys(){return Object.keys(this.filters).filter(e=>Array.isArray(this.filters[e])&&this.filters[e].length||!Array.isArray(this.filters[e])&&this.filters[e])},filterCounter(){return this.filterTabKeys.length},onPageChangePayload(){return{...this.pagination,sortfield:this.idRowProperty}}},methods:{toggleFilters(e){this.dataTable.toggleFilterDrawer(e)},fetchData(e){this.dataTable.fetchDataTable(e)},updatePaginationData(e){this.dataTable.updatePaginationData(e)},updateColumnsTable(e){this.dataTable.updateColumnsTable(e)},clearDataFilters(){this.dataTable.updateFilters({}),this.dataTable.updateTabFiltersLabels({}),this.dataTable.fetchDataTable(this.fetchPayload)},deleteFilter(e){const t={...this.filters},a={...this.tabFilterLabels};delete t[e],delete a[e],this.dataTable.updateFilters(t),this.dataTable.updateTabFiltersLabels(a),this.dataTable.fetchDataTable(this.fetchPayload)},updateFiltersAndLabelTab({field:e,value:t},a){if(this.dataTable.updateFilters({...this.filters,[e]:t}),t)this.dataTable.updateTabFiltersLabels({...this.tabFilterLabels,[e]:a});else{const i={...this.tabFilterLabels};delete i[e],this.dataTable.updateTabFiltersLabels(i)}},onSort({field:e,order:t}){this.dataTable.updatePaginationData({...this.pagination,sortfield:e,sortorder:t}),this.dataTable.fetchDataTable(this.fetchPayload)},onRecordsPerPage(e){this.dataTable.updatePaginationData({...this.pagination,records_per_page:e}),this.dataTable.fetchDataTable(this.fetchPayload)},onPageChange(e){this.dataTable.updatePaginationData({...this.onPageChangePayload,page:e.page}),this.dataTable.fetchDataTable(this.fetchPayload)},goPreview(e){const t=e!=null&&e[this.idRowProperty]?{id:V.utf8ToBase64(e[this.idRowProperty])}:{};this.$router.push({name:`${this.routeBaseName}_view`,params:t}).catch(()=>console.warn("Router: Prevent default"))},goEdit(e){const t=e!=null&&e[this.idRowProperty]?{id:V.utf8ToBase64(e[this.idRowProperty])}:{id:"new"};this.$router.push({name:`${this.routeBaseName}_edit`,params:t}).catch(()=>console.warn("Router: Prevent default"))},deleteRow(e){const t=e!=null&&e[this.descriptionRowProperty]?`- ${e[this.descriptionRowProperty]}`:"";this.$swal({cancelButtonColor:"#a3a3a3",cancelButtonText:"Cancelar",confirmButtonColor:"#48c774",confirmButtonText:"Confirmar",icon:"warning",showCancelButton:!0,text:`Registro a eliminar ID ${e[this.idRowProperty]} ${t}`,title:"¿Estas seguro de eliminar el registro?",width:700}).then(a=>{if(a.isConfirmed){const i=this.$buefy.loading.open();z.delete(`${this.fetchPayload.url}/`,e[this.idRowProperty]).then(()=>{this.dataTable.fetchDataTable(this.fetchPayload)}).catch(h=>console.error(h)).finally(()=>i.close())}})}},beforeMount(){this.dataTable.updateFilters({}),this.dataTable.updateColumnsTable([]),this.dataTable.updatePaginationData({...this.pagination,page:1,sortfield:this.idRowProperty,sortorder:"desc"})}},W=P({name:"tt-ui-drawer",setup(){return{dataTable:U()}},props:{size:{type:String,default:()=>""},title:{type:String,default:()=>""},value:{type:Boolean,default:()=>!1}},methods:{initialization(){(document==null?void 0:document.getElementsByTagName("body")[0]).append(this.$el)}},mounted(){this.initialization()}}),X={class:"ttui-drawer"},Z={class:"ttui-drawer__header is-flex is-justify-content-space-between"},x={class:"title is-5 mb-0"},ee={class:"close"},te={class:"ttui-drawer__body"},ae={class:"ttui-drawer__footer"},ie={class:"ttui-drawer__footer-left"},se={class:"ttui-drawer__footer-right"};function oe(e,t,a,i,h,T){return o(),u("div",X,[l(M,{name:e.size==="small"?"right-fade-small-in-transition":"right-fade-in-transition"},{default:r(()=>[j(p("div",{class:D(["ttui-drawer__container",{"ttui-drawer__container--active":e.dataTable.showFilters,"ttui-drawer__container--small":e.size==="small"}])},[p("div",Z,[p("div",x,m(e.title),1),p("div",ee,[p("button",{class:"delete",onClick:t[0]||(t[0]=f=>{e.dataTable.toggleFilterDrawer(!1)})})])]),p("div",te,[A(e.$slots,"body")]),p("div",ae,[p("div",ie,[A(e.$slots,"footer-left")]),p("div",se,[A(e.$slots,"footer-right")])])],2),[[q,e.dataTable.showFilters]])]),_:3},8,["name"]),l(M,{name:"fade-transition-4"},{default:r(()=>[e.dataTable.showFilters?(o(),u("div",{key:0,class:D(["ttui-drawer__backdrop"]),onClick:t[1]||(t[1]=f=>{e.dataTable.toggleFilterDrawer(!1)})})):v("",!0)]),_:1})])}const re=w(W,[["render",oe]]),le=P({name:"tt-ui-divider",props:{pxHeight:{type:String,default:()=>"30px"},vertical:{type:Boolean,default:()=>!0}}});function ne(e,t,a,i,h,T){return o(),u("div",{class:D(["ttui-common__divider",{"ttui-common__divider--vertical":e.vertical}]),style:O({height:e.pxHeight})},null,6)}const de=w(le,[["render",ne]]),ue=P({name:"tt-ui-filters-tabs",props:{data:{type:Object,default:()=>({})},filters:{type:Object,default:()=>({})},tabNames:{type:Object,default:()=>({})}},computed:{keyNames(){return Object.keys(this.tabNames)},usedFilters(){const e=[];for(let t=0;t<this.keyNames.length;t+=1)(this.data[this.keyNames[t]]&&this.data[this.keyNames[t]].options&&this.isNotEmpty(this.filters[this.keyNames[t]])||!this.data[this.keyNames[t]]&&this.filters[this.keyNames[t]])&&this.isNotEmpty(this.filters[this.keyNames[t]])&&e.push(this.keyNames[t]);return e}},methods:{getValuesTab(e){if(this.data[e]){const a=this.data[e].options.filter(i=>Array.isArray(this.filters[e])?this.filters[e].includes(i[e]):i[e]?this.filters[e]===i[e]:this.filters[e]===i[this.data[e].idField]).map(i=>i[this.data[e].fieldName]).join(", ");return/^\d+$/.test(a)?parseInt(a):a}return R(this.filters[e],L.BACK_DEFAULT,!0).isValid()||R(this.filters[e],L.BACK_DATE_TIME,!0).isValid()?R(this.filters[e]).format(L.DEFAULT):this.filters[e]},isNotEmpty(e){return e!=null?typeof e=="string"&&e.trim()!==""?!0:Array.isArray(e)?e.length>0:!0:!1}}}),pe={class:"ttui-filter-tabs__container"},he={class:"pt-1"},fe={style:{"text-transform":"capitalize"},class:"mr-1"},be=["onClick"];function ce(e,t,a,i,h,T){return o(),u("div",pe,[(o(!0),u(F,null,C(e.usedFilters,(f,g)=>(o(),u("span",{key:g,class:"tag is-white is-medium mb-2 mr-2"},[p("span",he,[p("strong",fe,m(e.tabNames[f])+": ",1),$(" "+m(e.getValuesTab(f)),1)]),p("button",{class:"delete",onClick:b=>e.$emit("delete",f)},null,8,be)]))),128))])}const me=w(ue,[["render",ce]]),ge=P({name:"tt-ui-selector",data(){return{dataModel:[]}},props:{scrollable:{type:Boolean,default:()=>!1},appendToBody:{type:Boolean,default:()=>!1},keyOpt:{type:String,required:!0},nameOpt:{type:String,required:!0},options:{type:Array,default:()=>[]},maxHeight:{type:Number,default:()=>200},disabled:{type:Boolean,default:()=>!1},multiple:{type:Boolean,default:()=>!1},visibleOptions:{type:Number,default:()=>3},value:{type:[Array,String,Number],default:()=>[]},position:{types:String,default:()=>"is-bottom-right"},placeholder:{type:String,default:()=>"Seleccione una opción"}},watch:{dataModel(e){this.$emit("input",e)},value(e){JSON.stringify(this.dataModel)!==JSON.stringify(e)&&(this.dataModel=e)}},computed:{valueByMultipleOption(){if(this.multiple){const t=this.options.filter(a=>this.dataModel.includes(a[this.keyOpt])).map(a=>a[this.nameOpt]);return this.dataModel.length>this.visibleOptions?`Seleccionados: ${this.dataModel.length}`:t.join(",")}const e=this.options.filter(t=>t[this.keyOpt]===this.dataModel);return e&&e.length?e[0][this.nameOpt]:this.placeholder}},mounted(){this.dataModel=this.value}});function ye(e,t,a,i,h,T){const f=d("b-input"),g=d("b-dropdown-item"),b=d("b-dropdown");return o(),_(b,{"aria-role":"list",modelValue:e.dataModel,"onUpdate:modelValue":t[0]||(t[0]=y=>e.dataModel=y),disabled:e.disabled,multiple:e.multiple,position:e.position,"max-height":e.maxHeight,scrollable:e.scrollable,"append-to-body":e.appendToBody,class:"ttui-selector is-block"},{trigger:r(()=>[l(f,{readonly:"","icon-right":"angle-down",class:D(["ttui-selector__input",{"ttui-selector__input--placeholder":e.valueByMultipleOption===e.placeholder}]),modelValue:e.valueByMultipleOption},null,8,["modelValue","class"])]),default:r(()=>[(o(!0),u(F,null,C(e.options,y=>(o(),_(g,{key:y[e.keyOpt],"aria-role":"listitem",modelValue:y[e.keyOpt]},{default:r(()=>[p("span",null,m(y[e.nameOpt]),1)]),_:2},1032,["modelValue"]))),128))]),_:1},8,["modelValue","disabled","multiple","position","max-height","scrollable","append-to-body"])}const Te=w(ge,[["render",ye]]),_e=P({name:"tt-ui-data-table",components:{TtUiSelector:Te,TtUiStatusBar:H,TtUiButton:E},data(){return{page:1,records:15,resetTable:!1,dataTableAsync:[],stickyHeader:!1,sortIcon:"chevron-up",sortIconSize:"is-small",valuesPerPage:[...Array(20).keys()].map(e=>({value:(e+1)*5}))}},props:{titulo:{type:String,default:""},loading:{type:Boolean,required:!0},actions:{type:Boolean,required:!0},sortField:{type:String,required:!0},paginated:{type:Boolean,default:!0},totalRecords:{type:Number,required:!0},counter:{type:Boolean,default:()=>!0},actionbuttons:{type:Array,default:()=>[]},estilo:{type:String,default:"websafiTable"},defaultsortorder:{type:String,required:!0},recordsPerPage:{type:Number,default:()=>15},paginationSimple:{type:Boolean,default:!1},paginationRounded:{type:Boolean,default:!1},outputDateFormat:{type:String,default:"DD/MM/YYYY"},columns:{type:Array,required:!0,default:()=>[]},tableData:{type:Array,required:!0,default:()=>[]}},watch:{columns(){this.resetTable=!0,this.dataTableAsync=[],setTimeout(()=>{this.resetTable=!1},50)},tableData(e){this.dataTableAsync=e},recordsPerPage(e){this.records=e},records(e,t){e!==t&&this.$emit("changeRecordsPerPage",e)}},mixins:[K,Y],methods:{formatNumber(e){return V.formatNumber(e)},onPageChange(e){this.$emit("pageChange",{page:e})},onSort(e,t){this.$emit("sort",{field:e,order:t})},getDateFormat(e,t){const{field:a,time:i}=t,h=i?`${e[a]} ${e[i]}`:e[a];return h!=null?this.formatDate(h,!!i):""},getDateDiff(e,t){const{lDateIni:a,lDateEnd:i,lTimeIni:h,lTimeEnd:T}=t,f=h?`${e[a]} ${e[h]}`:e[a],g=T?`${e[i]} ${e[T]}`:e[i];return this.diffBeetweenDates(f,g,"days")}}}),$e={style:{width:"100%"},class:"is-flex is-justify-content-center is-align-items-center"},Pe={key:0,class:"mr-2"},we={key:0},ve={key:1},Fe={key:2,style:{width:"150px",overflow:"hidden","text-overflow":"ellipsis"}},De={class:"content has-text-grey has-text-centered"},Ce=p("p",null,"No se encontraron datos.",-1);function ke(e,t,a,i,h,T){const f=d("tt-ui-button"),g=d("b-dropdown-item"),b=d("b-dropdown"),y=d("b-table-column"),k=d("tt-ui-status-bar"),S=d("tt-ui-selector"),B=d("b-icon"),N=d("b-table");return o(),u("div",{class:D([e.estilo,"mb-5"])},[e.resetTable?v("",!0):(o(),_(N,{key:0,hoverable:"",loading:e.loading,data:e.dataTableAsync,"sticky-header":e.stickyHeader,onSort:e.onSort,onPageChange:e.onPageChange,"backend-pagination":"","per-page":e.records,total:e.totalRecords,paginated:e.paginated,"pagination-size":"small","pagination-order":"is-centered","pagination-simple":e.paginationSimple,"pagination-rounded":e.paginationRounded,"aria-page-label":"Page","aria-current-label":"Pagina Actual","aria-next-label":"Pagina Siguiente","aria-previous-label":"Pagina Previa","backend-sorting":"","sort-icon":e.sortIcon,"sort-icon-size":e.sortIconSize,"default-sort-direction":e.defaultsortorder,"default-sort":[e.sortField,e.defaultsortorder]},{"bottom-left":r(()=>[l(S,{scrollable:"",placeholder:"#","key-opt":"value","name-opt":"value",modelValue:e.records,"onUpdate:modelValue":t[0]||(t[0]=s=>e.records=s),"max-height":150,style:{width:"80px"},"visible-options":1,position:"is-top-right",options:e.valuesPerPage},null,8,["modelValue","options"])]),empty:r(()=>[p("div",De,[l(B,{icon:"info-circle",size:"is-large"}),Ce])]),default:r(()=>[e.actions?(o(),_(y,{key:0,width:"80",label:"Acciones"},{default:r(s=>[p("div",$e,[e.counter?(o(),u("div",Pe,m(s.index+1),1)):v("",!0),l(b,{"aria-role":"list",position:"is-bottom-right"},{trigger:r(()=>[l(f,{icon:"ellipsis-v"})]),default:r(()=>[(o(!0),u(F,null,C(e.actionbuttons,(n,c)=>(o(),_(g,{key:c,scrollable:"",separator:n.separator,"append-to-body":"","aria-role":"listitem",onClick:Le=>e.$emit(n.event,s.row),disabled:typeof n.disabled=="boolean"?n.disabled:n.disabled(s.row)},{default:r(()=>[$(m(n.label),1)]),_:2},1032,["separator","onClick","disabled"]))),128))]),_:2},1024)])]),_:1})):v("",!0),(o(!0),u(F,null,C(e.columns,(s,n)=>(o(),_(y,{key:n,field:s.field,label:s.label,width:s.width,visible:s.visible,numeric:s.numeric,sortable:s.sortable,centered:s.centered},{default:r(c=>[s.statusField?(o(),_(k,{key:0,label:c.row[s.descriptionField]?c.row[s.descriptionField]:c.row[s.field],status:c.row[s.colorField?s.colorField:"color_label"]},null,8,["label","status"])):(o(),u(F,{key:1},[s.date?(o(),u("div",we,m(e.getDateFormat(c.row,s)),1)):s.diffDate?(o(),u("div",ve,m(e.getDateDiff(c.row,s)),1)):s.limit?(o(),u("div",Fe,m(c.row[s.field]),1)):s.numberField?(o(),u("div",{key:3,style:O({width:`${s.width}px`})},m(e.formatNumber(c.row[s.field])),5)):(o(),u("div",{key:4,style:O({width:`${s.width}px`})},m(c.row[s.field]),5))],64))]),_:2},1032,["field","label","width","visible","numeric","sortable","centered"]))),128))]),_:1},8,["loading","data","sticky-header","onSort","onPageChange","per-page","total","paginated","pagination-simple","pagination-rounded","sort-icon","sort-icon-size","default-sort-direction","default-sort"]))],2)}const Se=w(_e,[["render",ke]]),Be=P({name:"tt-ui-list",setup(){return{dataTable:U()}},data(){return{id_usuario:null,status:[],modules:[],isFetching:!1,idRowProperty:"id_usuario",routeBaseName:"parametric.users",descriptionRowProperty:"id_usuario",fetchPayload:{withParams:!0,url:""},actionbuttons:[{event:"view",label:"Visualizar",disabled:!1},{event:"edit",label:"Editar",disabled:!1},{separator:!0,disabled:!1},{event:"delete",label:"Eliminar",disabled:!1}]}},components:{TtUiDataTable:Se,TtUiFiltersTabs:me,TtUiDivider:de,TtUiHeaderBar:J,TtUiButton:E,TtUiDrawer:re},mixins:[Q],mounted(){this.updatePaginationData({...this.pagination,sortfield:"id_usuario",page:1}),this.fetchData(this.fetchPayload),this.updateColumnsTable(G)}}),Ne={class:"is-flex is-align-items-center"},Ae={class:"p-5 mb-6"};function Re(e,t,a,i,h,T){const f=d("b-input"),g=d("b-field"),b=d("tt-ui-button"),y=d("tt-ui-drawer"),k=d("b-tooltip"),S=d("tt-ui-divider"),B=d("tt-ui-header-bar"),N=d("tt-ui-filters-tabs"),s=d("tt-ui-data-table");return o(),u("section",null,[l(y,{size:"small",modelValue:e.showFilters,title:"Filtrar resultados"},{body:r(()=>[l(g,{label:"ID Usuario"},{default:r(()=>[l(f,{modelValue:e.filters.id_usuario,"onUpdate:modelValue":t[0]||(t[0]=n=>e.updateFiltersAndLabelTab({field:"id_usuario",value:n},"ID"))},null,8,["modelValue"])]),_:1}),l(g,{label:"Usuario"},{default:r(()=>[l(f,{modelValue:e.filters.usuario,"onUpdate:modelValue":t[1]||(t[1]=n=>e.updateFiltersAndLabelTab({field:"usuario",value:n},"Usuario"))},null,8,["modelValue"])]),_:1})]),"footer-right":r(()=>[l(b,{onClick:t[2]||(t[2]=n=>e.toggleFilters(!1))},{default:r(()=>[$("Cancelar")]),_:1}),l(b,{success:"",class:"ml-2",onClick:t[3]||(t[3]=n=>{e.fetchData(e.fetchPayload),e.toggleFilters(!1)})},{default:r(()=>[$("Buscar")]),_:1})]),"footer-left":r(()=>[l(b,{onClick:t[4]||(t[4]=n=>e.clearDataFilters())},{default:r(()=>[$("Limpiar")]),_:1})]),_:1},8,["modelValue"]),l(B,{title:"Usuarios"},{actions:r(()=>[p("div",Ne,[l(b,{class:"mr-2",icon:"redo",onClick:t[5]||(t[5]=n=>e.fetchData(e.fetchPayload))}),l(k,{label:"Filtros",position:"is-left",type:"is-dark"},{default:r(()=>[l(b,{"show-count":"",icon:"filter",count:e.filterCounter,onClick:t[6]||(t[6]=n=>e.toggleFilters(!0))},null,8,["count"])]),_:1}),l(S,{vertical:"",class:"mx-3"}),l(b,{class:"mr-2",onClick:t[7]||(t[7]=n=>e.$router.push({name:"task-tracker.home"}))},{default:r(()=>[$("Volver")]),_:1}),l(b,{success:"",onClick:t[8]||(t[8]=n=>e.goEdit())},{default:r(()=>[$("Crear")]),_:1})])]),_:1}),p("div",Ae,[e.filterCounter?(o(),_(N,{key:0,filters:e.filters,"tab-names":e.tabFilterLabels,onDelete:t[9]||(t[9]=n=>e.deleteFilter(n)),data:{nombre_modulo:{options:e.modules,fieldName:"nombre_modulo"}}},null,8,["filters","tab-names","data"])):v("",!0),l(s,{paginated:!0,"table-data":e.data,columns:e.columns,loading:e.showLoader,"sort-field":"id_usuario","total-records":e.totalRecords,"records-per-page":e.recordsPerPage,actions:!0,defaultsortorder:"ASC",actionbuttons:e.actionbuttons,onSort:e.onSort,onEdit:e.goEdit,onView:e.goPreview,onDelete:e.deleteRow,onPageChange:e.onPageChange},null,8,["table-data","columns","loading","total-records","records-per-page","actionbuttons","onSort","onEdit","onView","onDelete","onPageChange"])])])}const Me=w(Be,[["render",Re]]);export{Me as default};
